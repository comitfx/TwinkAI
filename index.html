<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>twinkAI – Offline + Online</title>
    <link rel="icon" href="TWINK.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <style>
        :root { --primary: #1a73e8; --bg: #ffffff; --text: #202124; --text2: #5f6368; --border: #dadce0; --shadow: 0 1px 3px rgba(0, 0, 0, .1); --grad: linear-gradient(135deg, #1a73e8 0%, #4285f4 50%, #34a853 100%); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "Google Sans", sans-serif; background: var(--bg); color: var(--text); }
        .header { height: 64px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 24px; position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: var(--bg); box-shadow: var(--shadow); }
        .logo-img { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; }
        .brand { font-size: 22px; font-weight: 500; margin-left: 12px; }
        .main { display: flex; height: calc(100vh - 64px); margin-top: 64px; }
        .sidebar { width: 280px; border-right: 1px solid var(--border); padding: 16px; display: flex; flex-direction: column; }
        .new-btn { width: 100%; padding: 12px 16px; background: var(--primary); color: #fff; border: none; border-radius: 24px; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .history { flex: 1; overflow-y: auto; margin-top: 16px; }
        .chat-area { flex: 1; display: flex; flex-direction: column; }
        .chat-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
        .messages { flex: 1; overflow-y: auto; padding: 24px; display: flex; flex-direction: column; gap: 16px; }
        .message { display: flex; gap: 12px; max-width: 800px; animation: fade .3s; }
        .message.user { align-self: flex-end; flex-direction: row-reverse; }
        .avatar { width: 36px; height: 36px; border-radius: 50%; display: grid; place-items: center; font-size: 14px; font-weight: 500; flex-shrink: 0; }
        .user .avatar { background: var(--grad); color: #fff; }
        .assistant .avatar { background: #f8f9fa; color: var(--text2); }
        .bubble { background: #f8f9fa; padding: 16px; border-radius: 16px; max-width: 600px; font-size: 15px; line-height: 1.5; box-shadow: var(--shadow); }
        .user .bubble { background: var(--primary); color: #fff; }
        .typing { display: flex; gap: 4px; padding: 16px; background: #f8f9fa; border-radius: 16px; width: fit-content; }
        .typing dot { width: 8px; height: 8px; background: var(--text2); border-radius: 50%; animation: typing 1.4s infinite; }
        .typing dot:nth-child(2) { animation-delay: .2s; }
        .typing dot:nth-child(3) { animation-delay: .4s; }
        @keyframes typing { 0%,60%,100% { opacity: .3; transform: translateY(0); } 30% { opacity: 1; transform: translateY(-5px); } }
        @keyframes fade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .input-area { padding: 24px; border-top: 1px solid var(--border); }
        .input-wrap { position: relative; max-width: 800px; margin: auto; }
        #chatInput { width: 100%; padding: 16px 48px 16px 16px; border: 1px solid var(--border); border-radius: 24px; resize: none; font-family: inherit; font-size: 15px; outline: none; }
        #chatInput:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(26,115,232,.1); }
        #sendBtn { position: absolute; right: 12px; bottom: 12px; width: 32px; height: 32px; border: none; background: var(--primary); color: #fff; border-radius: 50%; display: grid; place-items: center; cursor: pointer; }
        #sendBtn:disabled { background: var(--text2); cursor: not-allowed; }
        .welcome { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 48px 24px; }
        .welcome-logo { width: 80px; height: 80px; background: var(--grad); border-radius: 50%; display: grid; place-items: center; color: #fff; font-size: 36px; font-weight: 600; margin-bottom: 24px; animation: pulse 2s infinite; }
        @keyframes pulse { 50% { transform: scale(1.05); } }
        .welcome h2 { font-size: 32px; margin-bottom: 16px; }
        .welcome p { font-size: 18px; color: var(--text2); max-width: 600px; margin-bottom: 48px; }
        .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; max-width: 800px; }
        .card { background: var(--bg); border: 1px solid var(--border); border-radius: 16px; padding: 20px; cursor: pointer; transition: all .2s; }
        .card:hover { border-color: var(--primary); box-shadow: var(--shadow); transform: translateY(-2px); }
        .card-icon { width: 40px; height: 40px; background: var(--grad); border-radius: 12px; display: grid; place-items: center; color: #fff; margin-bottom: 12px; }
        .card h4 { font-size: 16px; margin-bottom: 8px; }
        .card p { font-size: 14px; color: var(--text2); }
        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -280px; top: 64px; bottom: 0; z-index: 99; transition: left .3s; background: var(--bg); }
            .sidebar.open { left: 0; }
            .cards { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div style="display:flex;align-items:center">
            <img src="TWINK.jpg" alt="twinkAI" class="logo-img">
            <span class="brand">twinkAI</span>
        </div>
        <nav style="display:flex;align-items:center;gap:12px">
            <button class="icon-button" onclick="toggleSidebar()">
                <span class="material-symbols-outlined">menu</span>
            </button>
        </nav>
    </header>

    <div class="main">
        <aside class="sidebar" id="sidebar">
            <button class="new-btn" onclick="newChat()">
                <span class="material-symbols-outlined">add</span> New chat
            </button>
            <div class="history" id="history"></div>
        </aside>

        <section class="chat-area">
            <div class="chat-header">
                <h2 id="chatTitle">New chat</h2>
            </div>
            <div class="messages" id="messages">
                <div class="welcome" id="welcome">
                    <div class="welcome-logo">
                        <img src="TWINK.jpg" alt="twinkAI" style="width:100%;height:100%;object-fit:cover;border-radius:50%">
                    </div>
                    <h2>Hello, I'm twinkAI</h2>
                    <p>Your unlimited free AI assistant. Ask me anything!</p>
                    <div class="cards">
                        <div class="card" onclick="quick('Write a professional email')">
                            <div class="card-icon"><span class="material-symbols-outlined">mail</span></div>
                            <h4>Write an email</h4><p>Craft perfect emails</p>
                        </div>
                        <div class="card" onclick="quick('Explain quantum computing simply')">
                            <div class="card-icon"><span class="material-symbols-outlined">science</span></div>
                            <h4>Learn something</h4><p>Clear explanations</p>
                        </div>
                        <div class="card" onclick="quick('Plan a 3-day trip to Kyoto')">
                            <div class="card-icon"><span class="material-symbols-outlined">travel</span></div>
                            <h4>Plan a trip</h4><p>Travel itineraries</p>
                        </div>
                        <div class="card" onclick="quick('Python code to sort a list')">
                            <div class="card-icon"><span class="material-symbols-outlined">code</span></div>
                            <h4>Write code</h4><p>Programming help</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="input-area">
                <div class="input-wrap">
                    <textarea id="chatInput" placeholder="Message twinkAI…" rows="1"></textarea>
                    <button id="sendBtn" onclick="send()"><span class="material-symbols-outlined">send</span></button>
                </div>
            </div>
        </section>
    </div>

    <script>
        /* ---------- OFFLINE FALLBACK ---------- */
        // tiny on-device replies when remote fails
        const OFFLINE_REPLIES = [
            "I’m offline right now, but here’s a quick thought: try breaking the problem into smaller steps.",
            "No internet – still thinking! Maybe rephrase your question?",
            "Offline mode: I’d love to help, but I need the web for a full answer.",
            "I’m running local-mode – the internet will be back soon!"
        ];

        /* ---------- ONLINE ENDPOINT ---------- */
        const ONLINE_API = "https://chat.nbox.ai/api/v1/chat/completions";
        const MODEL      = "glm-4.6:free";

        const $ = q => document.querySelector(q);
        const esc = str => str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

        function addBubble(text, who) {
            const msg = document.createElement("div");
            msg.className = "message " + who;
            msg.innerHTML = `
                <div class="avatar">${who === "user" ? "U" : "T"}</div>
                <div class="bubble">${esc(text)}</div>`;
            $("#messages").appendChild(msg);
            msg.scrollIntoView({ behavior: "smooth" });
        }
        function typing(on) {
            if (on) {
                const t = document.createElement("div");
                t.id = "typing";
                t.className = "message assistant";
                t.innerHTML = `
                    <div class="avatar">T</div>
                    <div class="typing"><dot></dot><dot></dot><dot></dot></div>`;
                $("#messages").appendChild(t);
                t.scrollIntoView({ behavior: "smooth" });
            } else {
                $("#typing")?.remove();
            }
        }
        function quick(txt) {
            $("#chatInput").value = txt;
            send();
        }

        /* ---------- core ---------- */
        async function send() {
            const inp = $("#chatInput");
            const text = inp.value.trim();
            if (!text) return;
            $("#welcome")?.remove();
            addBubble(text, "user");
            inp.value = "";
            inp.style.height = "auto";
            typing(true);

            // try online first, fall back to offline instantly
            const reply = await callOnline(text).catch(() => offlineReply());
            typing(false);
            addBubble(reply, "assistant");
            saveThread(text, reply);
        }
        async function callOnline(prompt) {
            const res = await fetch(ONLINE_API, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: MODEL,
                    messages: [{ role: "user", content: prompt }],
                    temperature: 0.7,
                    max_tokens: 700
                })
            });
            if (!res.ok) throw new Error("Online failed");
            const json = await res.json();
            return json.choices[0].message.content.trim();
        }
        function offlineReply() {
            return OFFLINE_REPLIES[Math.floor(Math.random() * OFFLINE_REPLIES.length)];
        }
        function newChat() {
            $("#messages").innerHTML = `
                <div class="welcome" id="welcome">
                    <div class="welcome-logo">
                        <img src="TWINK.jpg" alt="twinkAI" style="width:100%;height:100%;object-fit:cover;border-radius:50%">
                    </div>
                    <h2>Hello, I'm twinkAI</h2>
                    <p>Your unlimited free AI assistant. Ask me anything!</p>
                    <div class="cards">
                        <div class="card" onclick="quick('Write a professional email')"><div class="card-icon"><span class="material-symbols-outlined">mail</span></div><h4>Write an email</h4><p>Craft perfect emails</p></div>
                        <div class="card" onclick="quick('Explain quantum computing simply')"><div class="card-icon"><span class="material-symbols-outlined">science</span></div><h4>Learn something</h4><p>Clear explanations</p></div>
                        <div class="card" onclick="quick('Plan a 3-day trip to Kyoto')"><div class="card-icon"><span class="material-symbols-outlined">travel</span></div><h4>Plan a trip</h4><p>Travel itineraries</p></div>
                        <div class="card" onclick="quick('Python code to sort a list')"><div class="card-icon"><span class="material-symbols-outlined">code</span></div><h4>Write code</h4><p>Programming help</p></div>
                    </div>
                </div>`;
            $("#chatTitle").textContent = "New chat";
        }
        function toggleSidebar() {
            $("#sidebar").classList.toggle("open");
        }
        function saveThread(q, a) {
            const hist = $("#history");
            const item = document.createElement("div");
            item.className = "card";
            item.style.padding = "12px";
            item.textContent = q.slice(0, 40) + "…";
            item.onclick = () => {
                $("#messages").innerHTML = "";
                addBubble(q, "user");
                addBubble(a, "assistant");
                $("#chatTitle").textContent = q.slice(0, 30) + "…";
            };
            hist.insertBefore(item, hist.firstChild);
        }

        /* input helpers */
        $("#chatInput").addEventListener("keydown", e => {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                send();
            }
        });
        $("#chatInput").addEventListener("input", e => {
            e.target.style.height = "auto";
            e.target.style.height = Math.min(e.target.scrollHeight, 120) + "px";
        });
    </script>
</body>
</html>